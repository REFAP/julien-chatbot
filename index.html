<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Julien - Expert FAP Re-Fap | Diagnostic Gratuit</title>
    <meta name="description" content="Diagnostic gratuit FAP/EGR/AdBlue avec Julien, expert depuis 20 ans. Analysez vos voyants moteur, obtenez solutions et devis Re-Fap.">
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const JulienProduction = () => {
            const [messages, setMessages] = useState([
                {
                    type: 'bot',
                    content: "Salut ! üëã Moi c'est Julien, expert FAP/EGR/AdBlue depuis 20 ans chez Re-Fap. Je vais diagnostiquer ton probl√®me GRATUITEMENT ! D√©cris-moi ton souci ou envoie une photo de ton voyant üì∏",
                    timestamp: new Date()
                }
            ]);
            const [inputMessage, setInputMessage] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            const [showCallbackForm, setShowCallbackForm] = useState(false);
            const [callbackData, setCallbackData] = useState({
                nom: '',
                telephone: '',
                email: '',
                probleme: '',
                vehicule: ''
            });
            const [leadData, setLeadData] = useState({
                sessionId: Math.random().toString(36).substr(2, 9),
                startTime: new Date(),
                symptoms: [],
                vehicle: {},
                profile: '',
                contactRequested: false
            });

            useEffect(() => {
                trackEvent('session_start', { sessionId: leadData.sessionId });
            }, []);

            const trackEvent = (event, data = {}) => {
                console.log('üìä Event tracked:', event, data);
            };

            const addMessage = (content, type = 'bot', source = 'auto') => {
                setMessages(prev => [...prev, {
                    type,
                    content,
                    timestamp: new Date(),
                    source
                }]);
            };

            // CLAUDE FAIT TOUT LE DIALOGUE !
            const getClaudeResponse = async (userMsg, conversationHistory) => {
                try {
                    console.log('üß† Claude prend le relais complet...');
                    
                    // Construire l'historique pour Claude
                    const claudeHistory = conversationHistory.slice(-6).map(msg => ({
                        role: msg.type === 'user' ? 'user' : 'assistant',
                        content: typeof msg.content === 'string' ? msg.content : 'Message syst√®me'
                    }));
                    
                    // Ajouter le nouveau message
                    claudeHistory.push({
                        role: 'user',
                        content: userMsg
                    });

                    const response = await fetch('/api/analyze-image', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            conversation: claudeHistory,
                            prompt: `Tu es Julien, expert FAP/EGR/AdBlue depuis 20 ans chez Re-Fap. 

R√àGLES ABSOLUES:
1. REBONDIS TOUJOURS sur ce que dit le client
2. DONNES ton diagnostic expert  
3. TERMINES OBLIGATOIREMENT par 2-3 questions pr√©cises pour continuer
4. RESTES conversationnel comme si tu parlais √† un pote

STYLE JULIEN:
- M√©cano expert mais sympa
- "Ah !", "OK !", "Dis-moi..." 
- Questions directes et pratiques
- Pousse vers une solution Re-Fap

SP√âCIALIT√âS:
- FAP encrass√© ‚Üí Nettoyage Re-Fap  
- EGR d√©faillante ‚Üí Solutions Re-Fap
- Fum√©es, perte puissance, codes P2002/P2463
- Profil bricoleur VS garage

FORMAT OBLIGATOIRE:
[Diagnostic] + [Questions pour continuer] + [Orientation solution]

EXEMPLE:
"Ah ! Fum√©es + perte puissance = FAP satur√© √† 90% ! 

Dis-moi : tu as tent√© l'autoroute r√©cemment ? Et niveau voyants, tu as quoi d'allum√© exactement ?

Si √ßa marche pas, faudra passer au nettoyage Re-Fap !"

OBJECTIF: Diagnostic ‚Üí Questions ‚Üí Lead qualifi√©

TERMINES TOUJOURS PAR DES QUESTIONS !`
                        })
                    });

                    if (!response.ok) {
                        console.error('‚ùå Erreur Claude API:', response.status);
                        throw new Error(`Claude API Error: ${response.status}`);
                    }

                    const data = await response.json();
                    console.log('‚úÖ R√©ponse Claude:', data);
                    
                    if (data.success && data.analysis) {
                        trackEvent('claude_dialogue', { success: true, length: data.analysis.length });
                        return data.analysis;
                    } else if (data.fallback) {
                        return data.fallback;
                    } else {
                        throw new Error('R√©ponse Claude invalide');
                    }

                } catch (error) {
                    console.error('üí• Erreur Claude dialogue:', error);
                    trackEvent('claude_dialogue', { success: false, error: error.message });
                    
                    // Fallback minimal
                    return `Salut ! D√©cris-moi ton probl√®me auto, je vais t'aider √† diagnostiquer √ßa ! 
                    
Sp√©cialit√© : FAP/EGR/AdBlue üîß

Erreur temporaire : ${error.message}`;
                }
            };

            const handleSendMessage = async (e) => {
                e.preventDefault();
                if (!inputMessage.trim()) return;
                
                const userMsg = inputMessage.trim();
                addMessage(userMsg, 'user');
                setInputMessage('');
                setIsTyping(true);

                trackEvent('message_sent', { message: userMsg.substring(0, 50) });

                // CLAUDE FAIT TOUT !
                const response = await getClaudeResponse(userMsg, messages);
                addMessage(response, 'bot', 'claude');
                setIsTyping(false);
            };

            const handleImageUpload = async (event) => {
                const file = event.target.files[0];
                if (file) {
                    if (!file.type.startsWith('image/')) {
                        alert('üì∏ Merci d\'envoyer une image (JPG, PNG...)');
                        return;
                    }
                    
                    addMessage(`üì∏ Photo envoy√©e : ${file.name}`, 'user');
                    setIsTyping(true);
                    trackEvent('photo_uploaded', { fileName: file.name, fileSize: file.size });
                    
                    // Compression d'image
                    const compressImage = (file, maxWidth = 800, quality = 0.8) => {
                        return new Promise((resolve) => {
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            const img = new Image();
                            
                            img.onload = () => {
                                let { width, height } = img;
                                if (width > maxWidth) {
                                    height = (height * maxWidth) / width;
                                    width = maxWidth;
                                }
                                
                                canvas.width = width;
                                canvas.height = height;
                                ctx.drawImage(img, 0, 0, width, height);
                                
                                const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                                resolve(compressedDataUrl);
                            };
                            
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                img.src = e.target.result;
                            };
                            reader.readAsDataURL(file);
                        });
                    };
                    
                    try {
                        let imageData;
                        
                        if (file.size > 1024 * 1024) {
                            console.log('üóúÔ∏è Compression image en cours...');
                            imageData = await compressImage(file, 800, 0.8);
                            console.log('‚úÖ Image compress√©e');
                        } else {
                            const reader = new FileReader();
                            imageData = await new Promise((resolve) => {
                                reader.onload = (e) => resolve(e.target.result);
                                reader.readAsDataURL(file);
                            });
                        }
                        
                        // Analyse photo avec Claude
                        const response = await fetch('/api/analyze-image', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                image: imageData,
                                prompt: `Tu es Julien, expert FAP/EGR/AdBlue depuis 20 ans chez Re-Fap. Analyse cette photo de tableau de bord automobile et r√©ponds COMME JULIEN avec ton expertise !`
                            })
                        });

                        const data = await response.json();
                        
                        if (data.success && data.analysis) {
                            addMessage(`üì∏ **ANALYSE PHOTO EXPERT** üß†\n\n${data.analysis}`, 'bot', 'claude');
                        } else {
                            addMessage(`üì∏ Photo re√ßue ! Dis-moi ce que tu vois : voyants allum√©s, messages affich√©s, marque du v√©hicule ?`, 'bot', 'auto');
                        }
                        
                    } catch (error) {
                        console.error('‚ùå Erreur upload:', error);
                        addMessage(`‚ùå Erreur analyse : ${error.message}`, 'bot');
                    }
                    
                    setIsTyping(false);
                    event.target.value = '';
                }
            };

            const handleGarageClick = () => {
                trackEvent('garage_redirect', { sessionId: leadData.sessionId });
                window.open('https://www.idgarages.com/fr-fr/prestations/diagnostic-electronique?utm_source=re-fap&utm_medium=partenariat&utm_campaign=diagnostic-electronique&ept-publisher=re-fap&ept-name=re-fap-diagnostic-electronique', '_blank');
            };

            const handleCallbackClick = () => {
                trackEvent('callback_requested', { sessionId: leadData.sessionId });
                setShowCallbackForm(true);
                addMessage("Je souhaite √™tre rappel√© gratuitement", 'user');
                setTimeout(() => {
                    addMessage("üìû **Formulaire de rappel activ√© !**\n\nRemplis le formulaire qui s'affiche et un expert Re-Fap va t'appeler dans les 2h ! üéØ", 'bot', 'form');
                }, 500);
            };

            const handleCallbackSubmit = async (e) => {
                e.preventDefault();
                
                if (!callbackData.nom || !callbackData.telephone) {
                    alert('Nom et t√©l√©phone obligatoires !');
                    return;
                }

                try {
                    console.log('üìß Envoi via webhook externe...');
                    
                    // SOLUTION 1: Webhook Zapier/Make (simple et garanti)
                    const webhookData = {
                        nom: callbackData.nom,
                        telephone: callbackData.telephone,
                        email: callbackData.email || 'Non renseign√©',
                        probleme: callbackData.probleme || 'Non pr√©cis√©',
                        vehicule: callbackData.vehicule || 'Non pr√©cis√©',
                        sessionId: leadData.sessionId,
                        timestamp: new Date().toLocaleString('fr-FR'),
                        chatUrl: window.location.href,
                        destinataires: 'mgaume@re-fap.fr,contact@re-fap.fr'
                    };

                    console.log('üì§ Donn√©es √† envoyer:', webhookData);

                    // SOLUTION 2: FormSubmit.co (100% gratuit, pas de config)
                    const formData = new FormData();
                    formData.append('_to', 'mgaume@re-fap.fr,contact@re-fap.fr');
                    formData.append('_subject', `üî• NOUVEAU RAPPEL RE-FAP - ${callbackData.nom}`);
                    formData.append('_captcha', 'false');
                    formData.append('_template', 'basic');
                    formData.append('nom', callbackData.nom);
                    formData.append('telephone', callbackData.telephone);
                    formData.append('email', callbackData.email || 'Non renseign√©');
                    formData.append('probleme', callbackData.probleme || 'Non pr√©cis√©');
                    formData.append('vehicule', callbackData.vehicule || 'Non pr√©cis√©');
                    formData.append('sessionId', leadData.sessionId);
                    formData.append('timestamp', new Date().toLocaleString('fr-FR'));
                    formData.append('message', `
NOUVEAU RAPPEL RE-FAP - ${callbackData.nom}

üìã INFORMATIONS CLIENT :
‚Ä¢ Nom/Pr√©nom : ${callbackData.nom}
‚Ä¢ T√©l√©phone : ${callbackData.telephone}
‚Ä¢ Email : ${callbackData.email || 'Non renseign√©'}

üöó PROBL√àME V√âHICULE :
‚Ä¢ V√©hicule : ${callbackData.vehicule || 'Non pr√©cis√©'}
‚Ä¢ Probl√®me : ${callbackData.probleme || 'Non pr√©cis√©'}

üß† DONN√âES CHATBOT :
‚Ä¢ Session ID : ${leadData.sessionId}
‚Ä¢ Horodatage : ${new Date().toLocaleString('fr-FR')}
‚Ä¢ URL conversation : ${window.location.href}

‚ö° ACTION REQUISE : Rappeler ${callbackData.nom} au ${callbackData.telephone} sous 2h !

---
G√©n√©r√© automatiquement par Julien Chatbot Re-Fap
                    `);

                    console.log('üìß Envoi via FormSubmit.co...');

                    const response = await fetch('https://formsubmit.co/mgaume@re-fap.fr', {
                        method: 'POST',
                        body: formData
                    });

                    console.log('üìß R√©ponse FormSubmit:', response.status);

                    if (response.ok) {
                        console.log('‚úÖ Email envoy√© avec succ√®s via FormSubmit');

                        trackEvent('callback_form_submitted', { 
                            sessionId: leadData.sessionId,
                            phone: callbackData.telephone.substring(0, 4) + 'xxxx',
                            success: true,
                            method: 'formsubmit'
                        });

                        addMessage(`‚úÖ **Demande de rappel envoy√©e !**

üìß **Email envoy√© √† :**
‚Ä¢ mgaume@re-fap.fr
‚Ä¢ contact@re-fap.fr

üìã **R√©capitulatif :**
‚Ä¢ Nom : ${callbackData.nom}
‚Ä¢ T√©l√©phone : ${callbackData.telephone}
‚Ä¢ Probl√®me : ${callbackData.probleme || 'Non pr√©cis√©'}

üìû **Un expert Re-Fap va t'appeler sous 2h !**

En attendant, continue √† me poser des questions ! üîß`, 'bot', 'confirmation');

                    } else {
                        throw new Error(`FormSubmit error: ${response.status}`);
                    }

                    setShowCallbackForm(false);
                    setCallbackData({ nom: '', telephone: '', email: '', probleme: '', vehicule: '' });
                    
                } catch (error) {
                    console.error('‚ùå Erreur envoi callback:', error);
                    
                    // FALLBACK ULTIME : mailto automatique
                    const mailtoBody = `NOUVEAU RAPPEL RE-FAP - ${callbackData.nom}

INFORMATIONS CLIENT :
‚Ä¢ Nom/Pr√©nom : ${callbackData.nom}
‚Ä¢ T√©l√©phone : ${callbackData.telephone}
‚Ä¢ Email : ${callbackData.email || 'Non renseign√©'}

PROBL√àME V√âHICULE :
‚Ä¢ V√©hicule : ${callbackData.vehicule || 'Non pr√©cis√©'}
‚Ä¢ Probl√®me : ${callbackData.probleme || 'Non pr√©cis√©'}

DONN√âES CHATBOT :
‚Ä¢ Session ID : ${leadData.sessionId}
‚Ä¢ Horodatage : ${new Date().toLocaleString('fr-FR')}

ACTION REQUISE : Rappeler sous 2h !`;

                    const mailtoLink = `mailto:mgaume@re-fap.fr,contact@re-fap.fr?subject=üî• NOUVEAU RAPPEL RE-FAP - ${encodeURIComponent(callbackData.nom)}&body=${encodeURIComponent(mailtoBody)}`;
                    
                    console.log('üìß Fallback: ouverture mailto');
                    window.open(mailtoLink, '_blank');

                    trackEvent('callback_form_fallback', { 
                        sessionId: leadData.sessionId,
                        error: error.message,
                        method: 'mailto'
                    });

                    addMessage(`‚ö†Ô∏è **Email client ouvert !**

üìß **Un email pr√©-rempli s'ouvre** vers mgaume@re-fap.fr

üìã **Tes informations :**
‚Ä¢ Nom : ${callbackData.nom}
‚Ä¢ T√©l√©phone : ${callbackData.telephone}

üìû **Envoie l'email ou appelle directement Re-Fap !**

Continue le diagnostic avec moi ! üí™`, 'bot', 'fallback');

                    setShowCallbackForm(false);
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-orange-50">
                    {/* Header */}
                    <header className="bg-white shadow-sm border-b">
                        <div className="max-w-4xl mx-auto px-4 py-3 flex items-center justify-between">
                            <div className="flex items-center">
                                <div className="mr-3 bg-gradient-to-r from-green-500 to-green-600 px-4 py-2 rounded-lg shadow-sm">
                                    <span className="text-white font-bold text-lg">re-fap</span>
                                </div>
                                <div>
                                    <h1 className="text-lg font-bold text-gray-800">Julien - Expert FAP</h1>
                                    <p className="text-xs text-gray-600">Diagnostic gratuit ‚Ä¢ 20 ans d'exp√©rience</p>
                                </div>
                            </div>
                            <button 
                                onClick={() => window.open('https://re-fap.fr/contact/', '_blank')}
                                className="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                            >
                                üìû Devis gratuit
                            </button>
                        </div>
                    </header>

                    {/* Chat principal avec CTA responsive */}
                    <div className="max-w-6xl mx-auto p-4">
                        <div className="flex flex-col lg:flex-row gap-4">
                            {/* Chat principal */}
                            <div className="flex-1 bg-white rounded-xl shadow-lg overflow-hidden">
                                {/* Header chat */}
                                <div className="bg-gradient-to-r from-orange-600 to-red-600 text-white p-4">
                                    <div className="flex items-center">
                                        <div className="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center mr-3">
                                            <span className="text-2xl">üë®‚Äçüîß</span>
                                        </div>
                                        <div>
                                            <h2 className="text-xl font-bold">Julien, ton expert FAP</h2>
                                            <p className="text-orange-100 text-sm">Diagnostic GRATUIT ‚Ä¢ Sp√©cialiste Re-Fap depuis 20 ans</p>
                                        </div>
                                    </div>
                                </div>

                                {/* Messages */}
                                <div className="h-96 overflow-y-auto p-4 bg-gray-50">
                                    {messages.map((message, index) => (
                                        <div key={index} className={`mb-4 ${message.type === 'user' ? 'text-right' : ''}`}>
                                            <div className={`inline-block p-3 rounded-lg max-w-md ${
                                                message.type === 'user' 
                                                    ? 'bg-blue-500 text-white' 
                                                    : message.source === 'claude'
                                                        ? 'bg-purple-100 text-gray-800 border-l-4 border-purple-500'
                                                        : 'bg-white text-gray-800 border border-gray-200'
                                            }`}>
                                                {typeof message.content === 'string' ? 
                                                    message.content.split('\n').map((line, i) => (
                                                        <div key={i} className={line.startsWith('**') && line.endsWith('**') ? 'font-bold' : ''}>
                                                            {line.replace(/\*\*/g, '')}
                                                        </div>
                                                    )) : 
                                                    <div>Erreur affichage message</div>
                                                }
                                                
                                                {message.type === 'bot' && (
                                                    <div className="text-xs text-gray-400 mt-2">
                                                        {message.source === 'claude' ? 'üß† IA' : '‚ö° Expert'} ‚Ä¢ {new Date(message.timestamp).toLocaleTimeString()}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    ))}
                                    
                                    {isTyping && (
                                        <div className="mb-4">
                                            <div className="inline-block bg-white p-3 rounded-lg border border-gray-200">
                                                <div className="flex items-center space-x-2">
                                                    <div className="flex space-x-1">
                                                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                                                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.1s'}}></div>
                                                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                                                    </div>
                                                    <span className="text-sm text-gray-600">Julien analyse...</span>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* Input */}
                                <div className="p-4 border-t bg-white">
                                    <form onSubmit={handleSendMessage} className="flex gap-2 mb-3">
                                        <input
                                            type="text"
                                            value={inputMessage}
                                            onChange={(e) => setInputMessage(e.target.value)}
                                            placeholder="üí¨ D√©cris ton probl√®me... (ex: '√áa pue et √ßa fume en ville')"
                                            className="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500"
                                            disabled={isTyping}
                                        />
                                        <button
                                            type="submit"
                                            disabled={isTyping || !inputMessage.trim()}
                                            className="bg-orange-500 hover:bg-orange-600 disabled:bg-gray-300 text-white px-6 py-3 rounded-lg font-medium transition-colors"
                                        >
                                            Envoyer
                                        </button>
                                    </form>

                                    {/* Upload photo */}
                                    <div className="mb-3 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border-2 border-dashed border-blue-300">
                                        <div className="text-center">
                                            <input
                                                type="file"
                                                id="imageUpload"
                                                accept="image/*"
                                                onChange={handleImageUpload}
                                                className="hidden"
                                                disabled={isTyping}
                                            />
                                            <label 
                                                htmlFor="imageUpload" 
                                                className="cursor-pointer bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg inline-flex items-center gap-2 font-medium transition-colors"
                                            >
                                                üì∏ Photo de mon voyant
                                            </label>
                                            <p className="text-xs text-gray-600 mt-2">
                                                JPG/PNG max 5MB ‚Ä¢ Julien analysera automatiquement ! üß†
                                            </p>
                                        </div>
                                    </div>

                                    {/* Quick options */}
                                    <div className="grid grid-cols-2 gap-2 mb-4 lg:mb-0">
                                        {[
                                            { text: "üü° Voyant FAP", msg: "Voyant FAP allum√©" },
                                            { text: "üí® √áa fume", msg: "√áa pue et √ßa fume" },
                                            { text: "‚ö° Perte puissance", msg: "Plus de puissance en ville" },
                                            { text: "üîß Je suis bricoleur", msg: "Je d√©monte moi-m√™me" }
                                        ].map((option, index) => (
                                            <button
                                                key={index}
                                                onClick={async () => {
                                                    addMessage(option.msg, 'user');
                                                    setIsTyping(true);
                                                    const response = await getClaudeResponse(option.msg, messages);
                                                    addMessage(response, 'bot', 'claude');
                                                    setIsTyping(false);
                                                }}
                                                disabled={isTyping}
                                                className="bg-gray-100 hover:bg-gray-200 p-2 rounded text-sm disabled:opacity-50 transition-colors"
                                            >
                                                {option.text}
                                            </button>
                                        ))}
                                    </div>

                                    {/* CTA mobile - en bas du chat */}
                                    <div className="lg:hidden p-3 bg-gradient-to-r from-orange-50 to-red-50 rounded-lg border border-orange-200">
                                        <h4 className="font-bold text-orange-800 text-sm mb-2 text-center">üéØ Besoin d'aide ?</h4>
                                        <div className="grid grid-cols-1 gap-2">
                                            <button
                                                onClick={handleGarageClick}
                                                className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded text-sm font-medium transition-colors"
                                            >
                                                üè™ Trouver un garage de confiance
                                            </button>
                                            <button
                                                onClick={handleCallbackClick}
                                                className="bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded text-sm font-medium transition-colors"
                                            >
                                                üìû √ätre rappel√© gratuitement
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* CTA Section verticale - DESKTOP SEULEMENT */}
                            <div className="hidden lg:block w-64 space-y-4">
                                {/* Titre CTA */}
                                <div className="bg-orange-50 border border-orange-200 rounded-lg p-3 text-center">
                                    <h4 className="font-bold text-orange-800 text-sm mb-1">üéØ Besoin d'aide ?</h4>
                                    <p className="text-xs text-orange-600">Solutions Re-Fap personnalis√©es</p>
                                </div>

                                {/* Bouton Garage */}
                                <button
                                    onClick={handleGarageClick}
                                    className="w-full bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-lg font-medium transition-colors shadow-md hover:shadow-lg"
                                >
                                    <div className="text-center">
                                        <div className="text-2xl mb-2">üè™</div>
                                        <div className="font-bold">Trouver un garage</div>
                                        <div className="font-bold">de confiance</div>
                                        <div className="text-xs mt-1 opacity-90">R√©seau partenaire Re-Fap</div>
                                    </div>
                                </button>

                                {/* Bouton Rappel */}
                                <button
                                    onClick={handleCallbackClick}
                                    className="w-full bg-green-500 hover:bg-green-600 text-white p-4 rounded-lg font-medium transition-colors shadow-md hover:shadow-lg"
                                >
                                    <div className="text-center">
                                        <div className="text-2xl mb-2">üìû</div>
                                        <div className="font-bold">√ätre rappel√©</div>
                                        <div className="font-bold">gratuitement</div>
                                        <div className="text-xs mt-1 opacity-90">Expert sous 2h</div>
                                    </div>
                                </button>

                                {/* Info compl√©mentaire */}
                                <div className="bg-gray-50 border border-gray-200 rounded-lg p-3 text-center">
                                    <div className="text-xs text-gray-600">
                                        <div className="font-semibold text-green-600 mb-1">‚úÖ Diagnostic gratuit</div>
                                        <div>üß† IA + 20 ans exp√©rience</div>
                                        <div>üí∞ Solutions √©conomiques</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* FORMULAIRE DE RAPPEL - Modal */}
                        {showCallbackForm && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-xl shadow-2xl max-w-md w-full max-h-screen overflow-y-auto">
                                    {/* Header formulaire */}
                                    <div className="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-t-xl">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <h3 className="text-lg font-bold">üìû Rappel gratuit Re-Fap</h3>
                                                <p className="text-sm opacity-90">Expert sous 2h ouvr√©es</p>
                                            </div>
                                            <button 
                                                onClick={() => setShowCallbackForm(false)}
                                                className="text-white hover:bg-white hover:bg-opacity-20 p-1 rounded"
                                            >
                                                ‚úï
                                            </button>
                                        </div>
                                    </div>

                                    {/* Formulaire */}
                                    <form onSubmit={handleCallbackSubmit} className="p-6 space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Nom / Pr√©nom *
                                            </label>
                                            <input
                                                type="text"
                                                required
                                                value={callbackData.nom}
                                                onChange={(e) => setCallbackData({...callbackData, nom: e.target.value})}
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500"
                                                placeholder="Votre nom complet"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                T√©l√©phone *
                                            </label>
                                            <input
                                                type="tel"
                                                required
                                                value={callbackData.telephone}
                                                onChange={(e) => setCallbackData({...callbackData, telephone: e.target.value})}
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500"
                                                placeholder="06 12 34 56 78"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Email
                                            </label>
                                            <input
                                                type="email"
                                                value={callbackData.email}
                                                onChange={(e) => setCallbackData({...callbackData, email: e.target.value})}
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500"
                                                placeholder="votre@email.com"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                R√©sum√© du probl√®me
                                            </label>
                                            <textarea
                                                value={callbackData.probleme}
                                                onChange={(e) => setCallbackData({...callbackData, probleme: e.target.value})}
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500"
                                                placeholder="Voyants allum√©s, fum√©es, perte puissance..."
                                                rows="3"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                V√©hicule
                                            </label>
                                            <input
                                                type="text"
                                                value={callbackData.vehicule}
                                                onChange={(e) => setCallbackData({...callbackData, vehicule: e.target.value})}
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500"
                                                placeholder="Marque, mod√®le, ann√©e (ex: Peugeot 308 2018)"
                                            />
                                        </div>

                                        {/* Info RGPD */}
                                        <div className="bg-gray-50 p-3 rounded-lg text-xs text-gray-600">
                                            ‚úÖ Vos donn√©es sont utilis√©es uniquement pour le rappel. Aucun spam.
                                        </div>

                                        {/* Boutons */}
                                        <div className="flex gap-3">
                                            <button
                                                type="button"
                                                onClick={() => setShowCallbackForm(false)}
                                                className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 py-3 px-4 rounded-lg font-medium transition-colors"
                                            >
                                                Annuler
                                            </button>
                                            <button
                                                type="submit"
                                                className="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-medium transition-colors"
                                            >
                                                üìû Demander le rappel
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Footer */}
                    <footer className="max-w-4xl mx-auto px-4 py-6 text-center text-sm text-gray-600">
                        <div className="flex items-center justify-center space-x-6 mb-3">
                            <span className="flex items-center"><span className="text-green-500 mr-1">‚úÖ</span> Diagnostic gratuit</span>
                            <span className="flex items-center"><span className="text-blue-500 mr-1">üß†</span> IA + 20 ans exp√©rience</span>
                            <span className="flex items-center"><span className="text-orange-500 mr-1">üí∞</span> Solutions √©conomiques</span>
                        </div>
                        <p className="text-xs">
                            Powered by <a href="https://re-fap.fr" className="text-orange-600 hover:underline">Re-Fap</a> ‚Ä¢ 
                            Expert nettoyage FAP depuis 2015 ‚Ä¢ 
                            Session: {leadData.sessionId}
                        </p>
                    </footer>
                </div>
            );
        };

        ReactDOM.render(<JulienProduction />, document.getElementById('root'));
    </script>
</body>
</html>
