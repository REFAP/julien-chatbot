<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Julien - Robin des Bois de la Mécanique | Aide Anti-Arnaque Re-Fap</title>
    <meta name="description" content="Julien t'aide à faire durer ta voiture au meilleur coût. Diagnostic gratuit, solutions anti-arnaque, conseils de mécano militant depuis 20 ans.">
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 overflow-x-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const JulienMilitantChatbot = () => {
            const [messages, setMessages] = useState([
                {
                    type: 'bot',
                    content: "Salut ! 👋 C'est Julien, ton mécano militant depuis 20 ans !\n\n🛠️ **Je suis là pour t'aider** à faire durer ta voiture au meilleur coût, pas pour te vendre quoi que ce soit.\n\n💪 **Mon combat :** T'éviter les arnaques de l'industrie auto et te faire économiser des centaines d'euros !\n\nDécris-moi ton problème auto... 🚗",
                    timestamp: new Date(),
                    militant: true
                }
            ]);
            const [inputMessage, setInputMessage] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            const [showCallbackForm, setShowCallbackForm] = useState(false);
            const [userData, setUserData] = useState({});
            const [callbackData, setCallbackData] = useState({
                nom: '',
                telephone: '',
                email: '',
                probleme: '',
                vehicule: ''
            });
            const [sessionData, setSessionData] = useState({
                sessionId: Math.random().toString(36).substr(2, 9),
                startTime: new Date(),
                interactions: 0,
                helpProvided: 0
            });

            // États militants
            const [userLevel, setUserLevel] = useState(0);
            const [helpValue, setHelpValue] = useState(0);
            const [isEmailCollected, setIsEmailCollected] = useState(false);

            useEffect(() => {
                trackEvent('session_militant_start', { sessionId: sessionData.sessionId });
            }, []);

            const trackEvent = (event, data = {}) => {
                console.log('📊 Événement militant:', event, data);
            };

            const addMessage = (content, type = 'bot', source = 'militant') => {
                setMessages(prev => [...prev, {
                    type,
                    content,
                    timestamp: new Date(),
                    source,
                    militant: true
                }]);
            };

            // 🤝 FONCTION PRINCIPALE MILITANTE
            const getMilitantResponse = async (userMsg) => {
                try {
                    console.log('🤝 Julien Militant activé...');
                    
                    const response = await fetch('/api/chat-dual-brain', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            message: userMsg,
                            userData: userData,
                            sessionId: sessionData.sessionId
                        })
                    });

                    const data = await response.json();
                    
                    if (data.success && data.message) {
                        console.log('✅ Aide militante fournie:', data.metadata?.mode);
                        
                        // Mise à jour des données d'aide
                        if (data.metadata) {
                            setUserLevel(data.metadata.userLevel || 0);
                            setHelpValue(data.metadata.leadValue || 0);
                            
                            // Détection email collecté
                            if (data.metadata.email) {
                                setIsEmailCollected(true);
                                setUserData(prev => ({ ...prev, email: data.metadata.email }));
                            }
                        }
                        
                        setSessionData(prev => ({ 
                            ...prev, 
                            interactions: prev.interactions + 1,
                            helpProvided: prev.helpProvided + (data.metadata?.leadValue || 25)
                        }));
                        
                        return {
                            text: data.message,
                            mode: data.metadata?.mode || 'militant_helper',
                            score: data.score || 8.5
                        };
                    } else {
                        throw new Error(data.error || 'Erreur système');
                    }
                    
                } catch (error) {
                    console.error('❌ Erreur aide militante:', error);
                    return {
                        text: `Salut ! C'est Julien, ton mécano militant ! 🛠️\n\nPetit souci technique temporaire, mais je peux quand même t'aider !\n\nDécris-moi ton problème auto et je vais te donner des conseils anti-arnaque ! 💪\n\n*Erreur: ${error.message}*`,
                        mode: 'militant_fallback',
                        score: 7.0
                    };
                }
            };

            const handleSendMessage = async (e) => {
                e.preventDefault();
                if (!inputMessage.trim()) return;
                
                const userMsg = inputMessage.trim();
                addMessage(userMsg, 'user');
                setInputMessage('');
                setIsTyping(true);

                trackEvent('message_militant_sent', { 
                    message: userMsg.substring(0, 50),
                    userLevel,
                    helpValue
                });

                // Appel système militant
                const response = await getMilitantResponse(userMsg);
                addMessage(response.text, 'bot', response.mode);
                setIsTyping(false);
            };

            const handleImageUpload = async (event) => {
                const file = event.target.files[0];
                if (file) {
                    if (!file.type.startsWith('image/')) {
                        alert('📸 Envoie-moi une photo claire de ton problème !');
                        return;
                    }
                    
                    addMessage(`📸 Photo envoyée : ${file.name}`, 'user');
                    setIsTyping(true);
                    trackEvent('photo_militant_uploaded', { 
                        fileName: file.name, 
                        userLevel
                    });
                    
                    try {
                        // Analyse photo militante
                        const photoPrompt = `Photo problème auto - ${file.name}`;
                        const response = await getMilitantResponse(photoPrompt);
                        addMessage(`📸 **ANALYSE PHOTO MILITANTE** 🔧\n\n${response.text}`, 'bot', response.mode);
                        
                    } catch (error) {
                        console.error('❌ Erreur analyse photo:', error);
                        addMessage(`❌ Souci analyse photo, mais décris-moi ton problème en texte, je vais t'aider ! 💪`, 'bot');
                    }
                    
                    setIsTyping(false);
                    event.target.value = '';
                }
            };

            const handleGarageClick = () => {
                trackEvent('garage_confiance_requested', { sessionId: sessionData.sessionId, userLevel });
                window.open('https://re-fap.fr/trouver_garage_partenaire/', '_blank');
            };

            const handleCallbackClick = () => {
                trackEvent('aide_expert_requested', { sessionId: sessionData.sessionId, userLevel });
                setShowCallbackForm(true);
                addMessage("Je veux parler à un expert", 'user');
                setTimeout(() => {
                    addMessage("🤝 **Formulaire d'aide expert activé !**\n\nPas de vente, juste de l'aide personnalisée d'un vrai mécano ! 💪", 'bot', 'aide_expert');
                }, 500);
            };

            const handleCallbackSubmit = async (e) => {
                e.preventDefault();
                
                if (!callbackData.nom || !callbackData.telephone) {
                    alert('Nom et téléphone requis pour que notre expert te rappelle !');
                    return;
                }

                // Mise à jour userData
                const newUserData = {
                    ...userData,
                    email: callbackData.email,
                    phone: callbackData.telephone,
                    firstName: callbackData.nom,
                    vehicleModel: callbackData.vehicule
                };
                setUserData(newUserData);
                setUserLevel(2);

                try {
                    console.log('📞 Demande aide expert...');
                    
                    // Envoi demande d'aide
                    try {
                        if (typeof emailjs === 'undefined') {
                            console.log('📦 Chargement EmailJS...');
                            await new Promise((resolve, reject) => {
                                const script = document.createElement('script');
                                script.src = 'https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js';
                                script.onload = resolve;
                                script.onerror = reject;
                                document.head.appendChild(script);
                                setTimeout(reject, 5000);
                            });
                        }

                        emailjs.init('mUrOzXIRFoYWzUmeW');

                        const response = await emailjs.send(
                            'service_mnjblro',
                            'template_trg4q0n',
                            {
                                name: callbackData.nom,
                                subject: `🤝 DEMANDE AIDE EXPERT MILITANT - ${callbackData.nom}`,
                                message: `DEMANDE AIDE EXPERT JULIEN MILITANT

📋 INFORMATIONS CLIENT :
• Nom/Prénom : ${callbackData.nom}
• Téléphone : ${callbackData.telephone}
• Email : ${callbackData.email || 'Non renseigné'}

🚗 PROBLÈME VÉHICULE :
• Véhicule : ${callbackData.vehicule || 'Non précisé'}
• Problème : ${callbackData.probleme || 'Non précisé'}

🤝 DONNÉES AIDE MILITANTE :
• Session ID : ${sessionData.sessionId}
• Interactions : ${sessionData.interactions}
• Aide fournie : ${sessionData.helpProvided}€ d'économies
• User Level : ${userLevel}
• Approche : Militante anti-arnaque
• Horodatage : ${new Date().toLocaleString('fr-FR')}

📞 ACTION : Rappeler ${callbackData.nom} pour aide personnalisée
🎯 PAS DE VENTE - JUSTE DE L'AIDE EXPERTE !

Généré par Julien le Mécano Militant Re-Fap`
                            }
                        );

                        console.log('✅ Demande aide envoyée:', response);

                        addMessage(`✅ **Demande d'aide envoyée !**

📧 **Email automatique envoyé à mgaume@re-fap.fr**
🤝 **Approche militante confirmée (pas de vente !)**
💰 **Aide déjà fournie : ${sessionData.helpProvided}€ d'économies**

📋 **Récapitulatif :**
• Nom : ${callbackData.nom}
• Téléphone : ${callbackData.telephone}
• Approche : Aide experte anti-arnaque

📞 **Un expert va t'appeler pour t'aider (pas pour vendre) !**

Continue à me poser tes questions, je suis toujours là ! 🛠️`, 'bot', 'aide_expert_success');

                    } catch (emailjsError) {
                        console.log('📧 Fallback email...', emailjsError.message);
                        
                        const emailBody = `DEMANDE AIDE EXPERT MILITANT - ${callbackData.nom}

🤝 APPROCHE MILITANTE : Aide sans vente
💰 Économies déjà réalisées : ${sessionData.helpProvided}€
📊 Level : ${userLevel}
🎯 Interactions : ${sessionData.interactions}

📋 INFORMATIONS :
• Nom : ${callbackData.nom}
• Téléphone : ${callbackData.telephone}
• Email : ${callbackData.email || 'Non renseigné'}
• Véhicule : ${callbackData.vehicule || 'Non précisé'}
• Problème : ${callbackData.probleme || 'Non précisé'}

Session: ${sessionData.sessionId}`;

                        const mailtoLink = `mailto:mgaume@re-fap.fr?subject=${encodeURIComponent('🤝 AIDE EXPERT MILITANT - ' + callbackData.nom)}&body=${encodeURIComponent(emailBody)}`;
                        
                        window.open(mailtoLink, '_blank');

                        addMessage(`📧 **Email client ouvert !**
🤝 **Demande d'aide experte préparée**

💬 **Instructions :**
1. Email pré-rempli ouvert
2. Clique "Envoyer"
3. Aide experte garantie (pas de vente !)

💪 **Ton aide militante continue !**`, 'bot', 'mailto_fallback');
                    }

                } catch (error) {
                    console.error('Erreur demande aide:', error);
                    addMessage(`❌ Erreur temporaire : ${error.message}`, 'bot');
                }

                setShowCallbackForm(false);
                setCallbackData({ nom: '', telephone: '', email: '', probleme: '', vehicule: '' });
            };

            const getLevelName = () => {
                const names = {
                    0: 'Aide Gratuite',
                    1: 'Accompagnement Personnalisé', 
                    2: 'Support Expert',
                    3: 'Aide VIP'
                };
                return names[userLevel] || 'Helper';
            };

            const getModeDisplay = () => {
                const modes = {
                    'dual_brain_militant': '🤝 Dual Brain Militant',
                    'claude_militant': '🔧 Expert Claude',
                    'openai_militant': '💡 Assistant Humain',
                    'simulation_militante': '⚡ Aide Intelligente',
                    'militant_fallback': '🛠️ Mécano Manuel'
                };
                return modes[sessionData.lastMode] || '🤝 Aide Militante';
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-green-50 to-blue-50">
                    {/* Header militant */}
                    <header className="bg-white shadow-sm border-b-2 border-green-500">
                        <div className="max-w-6xl mx-auto px-2 sm:px-4 py-3">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center min-w-0 flex-1">
                                    <div className="mr-2 sm:mr-3 bg-gradient-to-r from-green-600 to-green-700 px-2 sm:px-4 py-1 sm:py-2 rounded-lg shadow-sm">
                                        <span className="text-white font-bold text-sm sm:text-lg">🤝 re-fap</span>
                                    </div>
                                    <div className="min-w-0 flex-1">
                                        <h1 className="text-sm sm:text-lg font-bold text-gray-800 truncate">Julien - Robin des Bois Mécanique</h1>
                                        <p className="text-xs text-green-700 hidden sm:block">
                                            {getModeDisplay()} • {getLevelName()} • {sessionData.helpProvided}€ économisés
                                        </p>
                                    </div>
                                </div>
                                <button 
                                    onClick={() => window.open('https://re-fap.fr/trouver_garage_partenaire/', '_blank')}
                                    className="bg-green-600 hover:bg-green-700 text-white px-2 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-medium transition-colors ml-2 whitespace-nowrap"
                                >
                                    <span className="hidden sm:inline">🛠️ Garages de confiance</span>
                                    <span className="sm:hidden">🛠️</span>
                                </button>
                            </div>
                        </div>
                        
                        {/* Status militant */}
                        <div className="text-xs text-center py-2 bg-gradient-to-r from-green-100 to-blue-100">
                            <span className="text-green-800 font-medium">
                                🤝 Aide Militante Active • {getLevelName()} • {sessionData.interactions} interactions • {sessionData.helpProvided}€ économisés
                            </span>
                        </div>
                    </header>

                    {/* Chat principal */}
                    <div className="max-w-6xl mx-auto p-2 sm:p-4">
                        <div className="flex flex-col lg:flex-row gap-2 sm:gap-4">
                            {/* Chat */}
                            <div className="flex-1 bg-white rounded-xl shadow-lg overflow-hidden border-2 border-green-200">
                                {/* Header chat militant */}
                                <div className="bg-gradient-to-r from-green-600 to-green-700 text-white p-4">
                                    <div className="flex items-center">
                                        <div className="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center mr-3">
                                            <span className="text-2xl">🤝</span>
                                        </div>
                                        <div>
                                            <h2 className="text-xl font-bold">Julien - Mécano Militant</h2>
                                            <p className="text-green-100 text-sm">
                                                Robin des Bois • Anti-Arnaque • {getLevelName()}
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                {/* Messages */}
                                <div className="h-96 overflow-y-auto p-2 sm:p-4 bg-gray-50">
                                    {messages.map((message, index) => (
                                        <div key={index} className={`mb-4 ${message.type === 'user' ? 'text-right' : ''}`}>
                                            <div className={`inline-block p-3 rounded-lg max-w-[85%] sm:max-w-md ${
                                                message.type === 'user' 
                                                    ? 'bg-green-500 text-white' 
                                                    : message.source?.includes('militant')
                                                        ? 'bg-green-50 text-gray-800 border-l-4 border-green-500'
                                                        : message.source?.includes('expert')
                                                            ? 'bg-blue-50 text-gray-800 border-l-4 border-blue-500'
                                                            : 'bg-white text-gray-800 border border-gray-200'
                                            }`}>
                                                {typeof message.content === 'string' ? 
                                                    message.content.split('\n').map((line, i) => (
                                                        <div key={i} className={line.startsWith('**') && line.endsWith('**') ? 'font-bold' : ''}>
                                                            {line.replace(/\*\*/g, '')}
                                                        </div>
                                                    )) : 
                                                    <div>Erreur affichage message</div>
                                                }
                                                
                                                {message.type === 'bot' && (
                                                    <div className="text-xs text-gray-400 mt-2">
                                                        {message.source?.includes('militant') ? '🤝 Aide Militante' : 
                                                         message.source?.includes('expert') ? '🔧 Expert' : 
                                                         '💪 Auto'} • {new Date(message.timestamp).toLocaleTimeString()}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    ))}
                                    
                                    {isTyping && (
                                        <div className="mb-4">
                                            <div className="inline-block bg-green-50 p-3 rounded-lg border-l-4 border-green-500">
                                                <div className="flex items-center space-x-2">
                                                    <div className="flex space-x-1">
                                                        <div className="w-2 h-2 bg-green-500 rounded-full animate-bounce"></div>
                                                        <div className="w-2 h-2 bg-green-600 rounded-full animate-bounce" style={{animationDelay: '0.1s'}}></div>
                                                        <div className="w-2 h-2 bg-green-700 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                                                    </div>
                                                    <span className="text-sm text-green-700">Julien analyse ton problème... 🤝🔧</span>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* Input */}
                                <div className="p-2 sm:p-4 border-t-2 border-green-200 bg-white">
                                    <form onSubmit={handleSendMessage} className="flex gap-2 mb-3">
                                        <input
                                            type="text"
                                            value={inputMessage}
                                            onChange={(e) => setInputMessage(e.target.value)}
                                            placeholder="💬 Décris ton problème auto..."
                                            className="flex-1 p-2 sm:p-3 border-2 border-green-300 rounded-lg focus:outline-none focus:border-green-500 text-sm"
                                            disabled={isTyping}
                                        />
                                        <button
                                            type="submit"
                                            disabled={isTyping || !inputMessage.trim()}
                                            className="bg-green-600 hover:bg-green-700 disabled:bg-gray-300 text-white px-3 sm:px-6 py-2 sm:py-3 rounded-lg font-medium transition-colors text-sm whitespace-nowrap"
                                        >
                                            <span className="hidden sm:inline">Envoyer</span>
                                            <span className="sm:hidden">📤</span>
                                        </button>
                                    </form>

                                    {/* Upload photo */}
                                    <div className="mb-3 p-2 sm:p-4 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg border-2 border-dashed border-green-400">
                                        <div className="text-center">
                                            <input
                                                type="file"
                                                id="imageUpload"
                                                accept="image/*"
                                                onChange={handleImageUpload}
                                                className="hidden"
                                                disabled={isTyping}
                                            />
                                            <label 
                                                htmlFor="imageUpload" 
                                                className="cursor-pointer bg-green-600 hover:bg-green-700 text-white px-3 sm:px-6 py-2 sm:py-3 rounded-lg inline-flex items-center gap-2 font-medium transition-colors text-sm"
                                            >
                                                📸 <span className="hidden sm:inline">Photo de ton problème</span><span className="sm:hidden">Photo</span>
                                            </label>
                                            <p className="text-xs text-green-700 mt-2 px-2">
                                                JPG/PNG max 5MB • Analyse militante ! 🤝
                                            </p>
                                        </div>
                                    </div>

                                    {/* Quick options militantes */}
                                    <div className="grid grid-cols-2 gap-1 sm:gap-2 mb-4 lg:mb-0">
                                        {[
                                            { text: "🌪️ Problème FAP", textMobile: "🌪️ FAP", msg: "Mon FAP déconne, voyant allumé" },
                                            { text: "🚗 Freins bizarres", textMobile: "🚗 Freins", msg: "Mes freins font du bruit" },
                                            { text: "⚠️ Voyant moteur", textMobile: "⚠️ Voyant", msg: "Voyant moteur orange allumé" },
                                            { text: "💰 Éviter arnaque", textMobile: "💰 Arnaque", msg: "On veut me vendre cher, c'est normal ?" }
                                        ].map((option, index) => (
                                            <button
                                                key={index}
                                                onClick={async () => {
                                                    addMessage(option.msg, 'user');
                                                    setIsTyping(true);
                                                    const response = await getMilitantResponse(option.msg);
                                                    addMessage(response.text, 'bot', response.mode);
                                                    setIsTyping(false);
                                                }}
                                                disabled={isTyping}
                                                className="bg-green-100 hover:bg-green-200 text-green-800 p-2 rounded text-xs sm:text-sm disabled:opacity-50 transition-colors border border-green-300"
                                            >
                                                <span className="hidden sm:inline">{option.text}</span>
                                                <span className="sm:hidden">{option.textMobile}</span>
                                            </button>
                                        ))}
                                    </div>

                                    {/* CTA mobile militant */}
                                    <div className="lg:hidden p-3 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg border-2 border-green-200">
                                        <h4 className="font-bold text-green-800 text-sm mb-2 text-center">🤝 Aide Militante</h4>
                                        <div className="grid grid-cols-1 gap-2">
                                            <button
                                                onClick={handleGarageClick}
                                                className="bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded text-sm font-medium transition-colors"
                                            >
                                                🛠️ Garages de confiance (pas d'arnaque)
                                            </button>
                                            <button
                                                onClick={handleCallbackClick}
                                                className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded text-sm font-medium transition-colors"
                                            >
                                                📞 Aide expert perso ({sessionData.helpProvided}€ économisés)
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar militante - DESKTOP */}
                            <div className="hidden lg:block w-64 space-y-4">
                                {/* Stats aide militante */}
                                <div className="bg-gradient-to-r from-green-50 to-blue-50 border-2 border-green-200 rounded-lg p-3 text-center">
                                    <h4 className="font-bold text-green-800 text-sm mb-1">🤝 Aide Fournie</h4>
                                    <div className="text-xs text-green-700 space-y-1">
                                        <div>Level: {getLevelName()}</div>
                                        <div>Économies: {sessionData.helpProvided}€</div>
                                        <div>Interactions: {sessionData.interactions}</div>
                                        <div>Mode: Anti-arnaque</div>
                                    </div>
                                </div>

                                {/* Bouton Garages confiance */}
                                <button
                                    onClick={handleGarageClick}
                                    className="w-full bg-green-600 hover:bg-green-700 text-white p-4 rounded-lg font-medium transition-colors shadow-md hover:shadow-lg border-2 border-green-500"
                                >
                                    <div className="text-center">
                                        <div className="text-2xl mb-2">🛠️</div>
                                        <div className="font-bold">Garages</div>
                                        <div className="font-bold">de confiance</div>
                                        <div className="text-xs mt-1 opacity-90">Réseau anti-arnaque</div>
                                    </div>
                                </button>

                                {/* Bouton Aide expert */}
                                <button
                                    onClick={handleCallbackClick}
                                    className="w-full bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-lg font-medium transition-colors shadow-md hover:shadow-lg border-2 border-blue-500"
                                >
                                    <div className="text-center">
                                        <div className="text-2xl mb-2">📞</div>
                                        <div className="font-bold">Aide expert</div>
                                        <div className="font-bold">personnalisée</div>
                                        <div className="text-xs mt-1 opacity-90">{sessionData.helpProvided}€ économisés • Pas de vente</div>
                                    </div>
                                </button>
                            </div>
                        </div>

                        {/* MODAL AIDE EXPERT */}
                        {showCallbackForm && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4">
                                <div className="bg-white rounded-xl shadow-2xl w-full max-w-md max-h-screen overflow-y-auto mx-2 border-2 border-green-300">
                                    <div className="bg-gradient-to-r from-green-600 to-green-700 text-white p-3 sm:p-4 rounded-t-xl">
                                        <div className="flex items-center justify-between">
                                            <div className="flex-1">
                                                <h3 className="text-base sm:text-lg font-bold">📞 Aide Expert Militante</h3>
                                                <p className="text-xs sm:text-sm opacity-90">Pas de vente - Juste de l'aide !</p>
                                            </div>
                                            <button 
                                                onClick={() => setShowCallbackForm(false)}
                                                className="text-white hover:bg-white hover:bg-opacity-20 p-1 rounded ml-2"
                                            >
                                                ✕
                                            </button>
                                        </div>
                                    </div>

                                    <form onSubmit={handleCallbackSubmit} className="p-4 sm:p-6 space-y-4">
                                        <div className="text-center mb-4">
                                            <div className="text-2xl mb-2">🤝</div>
                                            <p className="text-sm text-gray-600">
                                                Un expert mécano va te rappeler pour t'aider personnellement. Pas de vente, juste de l'aide !
                                            </p>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Nom / Prénom *
                                            </label>
                                            <input
                                                type="text"
                                                required
                                                value={callbackData.nom}
                                                onChange={(e) => setCallbackData({...callbackData, nom: e.target.value})}
                                                className="w-full p-2 sm:p-3 border-2 border-green-300 rounded-lg focus:outline-none focus:border-green-500 text-sm"
                                                placeholder="Ton nom complet"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Téléphone *
                                            </label>
                                            <input
                                                type="tel"
                                                required
                                                value={callbackData.telephone}
                                                onChange={(e) => setCallbackData({...callbackData, telephone: e.target.value})}
                                                className="w-full p-2 sm:p-3 border-2 border-green-300 rounded-lg focus:outline-none focus:border-green-500 text-sm"
                                                placeholder="06 12 34 56 78"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Email (optionnel)
                                            </label>
                                            <input
                                                type="email"
                                                value={callbackData.email}
                                                onChange={(e) => setCallbackData({...callbackData, email: e.target.value})}
                                                className="w-full p-2 sm:p-3 border-2 border-green-300 rounded-lg focus:outline-none focus:border-green-500 text-sm"
                                                placeholder="ton@email.com"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Résumé du problème
                                            </label>
                                            <textarea
                                                value={callbackData.probleme}
                                                onChange={(e) => setCallbackData({...callbackData, probleme: e.target.value})}
                                                className="w-full p-2 sm:p-3 border-2 border-green-300 rounded-lg focus:outline-none focus:border-green-500 text-sm"
                                                placeholder="Voyants, bruits, problèmes..."
                                                rows="3"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Véhicule
                                            </label>
                                            <input
                                                type="text"
                                                value={callbackData.vehicule}
                                                onChange={(e) => setCallbackData({...callbackData, vehicule: e.target.value})}
                                                className="w-full p-2 sm:p-3 border-2 border-green-300 rounded-lg focus:outline-none focus:border-green-500 text-sm"
                                                placeholder="Peugeot 308 2018"
                                            />
                                        </div>

                                        <div className="bg-green-50 p-2 sm:p-3 rounded-lg text-xs text-green-700 border border-green-200">
                                            🤝 <strong>Promesse militante :</strong>
                                            <br />• Aide experte personnalisée
                                            <br />• Aucune vente forcée
                                            <br />• Solutions anti-arnaque garanties
                                            <br />• Économies maximales pour toi
                                        </div>

                                        <div className="flex flex-col sm:flex-row gap-2 sm:gap-3">
                                            <button
                                                type="button"
                                                onClick={() => setShowCallbackForm(false)}
                                                className="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 sm:py-3 px-4 rounded-lg font-medium transition-colors text-sm"
                                            >
                                                Annuler
                                            </button>
                                            <button
                                                type="submit"
                                                className="w-full bg-green-600 hover:bg-green-700 text-white py-2 sm:py-3 px-4 rounded-lg font-medium transition-colors text-sm"
                                            >
                                                📞 Demander l'aide
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Footer militant */}
                    <footer className="max-w-6xl mx-auto px-2 sm:px-4 py-4 sm:py-6 text-center text-xs sm:text-sm text-gray-600">
                        <div className="flex flex-wrap items-center justify-center gap-2 sm:gap-6 mb-3">
                            <span className="flex items-center"><span className="text-green-600 mr-1">🤝</span> Aide Militante</span>
                            <span className="flex items-center"><span className="text-blue-600 mr-1">💰</span> {sessionData.helpProvided}€ économisés</span>
                            <span className="flex items-center"><span className="text-purple-600 mr-1">🛠️</span> {getLevelName()}</span>
                            <span className="flex items-center"><span className="text-orange-600 mr-1">📊</span> {sessionData.interactions} interactions</span>
                        </div>
                        <p className="text-xs px-2">
                            Powered by <a href="https://re-fap.fr" className="text-green-700 hover:underline">Re-Fap</a> • 
                            Julien le Mécano Militant •
                            <span className="hidden sm:inline"> Robin des Bois anti-arnaque •</span>
                            <span className="block sm:inline"> Session: {sessionData.sessionId}</span>
                        </p>
                    </footer>
                </div>
            );
        };

        ReactDOM.render(<JulienMilitantChatbot />, document.getElementById('root'));
    </script>
</body>
</html>
