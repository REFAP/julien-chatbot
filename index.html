<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Julien - Expert FAP Re-Fap | Diagnostic Gratuit</title>
    <meta name="description" content="Diagnostic gratuit FAP/EGR/AdBlue avec Julien, expert depuis 20 ans. Analysez vos voyants moteur, obtenez solutions et devis Re-Fap.">
    <meta name="keywords" content="diagnostic FAP, expert Re-Fap, voyant moteur, nettoyage FAP, EGR, AdBlue">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Julien - Expert FAP Re-Fap | Diagnostic Gratuit">
    <meta property="og:description" content="Diagnostic gratuit de vos probl√®mes FAP/EGR/AdBlue avec notre expert Julien. Photo de voyant analys√©e, solutions personnalis√©es.">
    <meta property="og:image" content="https://re-fap.fr/assets/images/julien-expert-fap.jpg">
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID');
    </script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const JulienProduction = () => {
            const [messages, setMessages] = useState([
                {
                    type: 'bot',
                    content: "Salut ! üëã Moi c'est Julien, expert FAP/EGR/AdBlue depuis 20 ans chez Re-Fap. Je vais diagnostiquer ton probl√®me GRATUITEMENT ! D√©cris-moi ton souci ou envoie une photo de ton voyant üì∏",
                    timestamp: new Date()
                }
            ]);
            const [inputMessage, setInputMessage] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            const [conversationHistory, setConversationHistory] = useState([]);
            const [leadData, setLeadData] = useState({
                sessionId: Math.random().toString(36).substr(2, 9),
                startTime: new Date(),
                symptoms: [],
                vehicle: {},
                contactRequested: false
            });

            // Configuration Claude API (√† configurer c√¥t√© serveur)
            const CLAUDE_API_KEY = ''; // √Ä configurer via variables d'environnement

            useEffect(() => {
                // Track session start
                trackEvent('session_start', { sessionId: leadData.sessionId });
            }, []);

            const trackEvent = (event, data = {}) => {
                // Google Analytics
                if (typeof gtag !== 'undefined') {
                    gtag('event', event, {
                        custom_parameter_1: data.sessionId,
                        custom_parameter_2: data.symptom || '',
                        custom_parameter_3: data.vehicle || ''
                    });
                }
                
                // Log pour debug
                console.log('üìä Event tracked:', event, data);
                
                // Envoi vers votre CRM (√† impl√©menter)
                // fetch('/api/track-lead', { method: 'POST', body: JSON.stringify({event, data}) });
            };

            const addMessage = (content, type = 'bot', source = 'auto') => {
                setMessages(prev => [...prev, {
                    type,
                    content,
                    timestamp: new Date(),
                    source
                }]);
            };

            // Analyse photo avec Claude Vision via Vercel Function
            const analyzeImageWithClaude = async (imageBase64, fileName) => {
                try {
                    console.log('üîß Appel API Vercel Function...');
                    
                    const response = await fetch('/api/analyze-image', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            image: imageBase64,
                            prompt: `Tu es Julien, expert FAP/EGR/AdBlue depuis 20 ans chez Re-Fap. Analyse cette photo de tableau de bord automobile.

ANALYSE PR√âCISE :
1. Quels voyants sont allum√©s (couleur, forme, position) ?
2. Y a-t-il des messages d'erreur affich√©s ?
3. Peux-tu identifier la marque/mod√®le du v√©hicule ?
4. Si voyant FAP/moteur/antipollution : diagnostic expert ?

R√âPONDS COMME JULIEN :
- Direct, pr√©cis, professionnel mais humain
- Propose solution Re-Fap si d√©pollution
- Sinon redirige vers partenaires
- Termine par une question pour continuer le diagnostic

OBJECTIF : G√©n√©rer un lead qualifi√© pour Re-Fap`
                        })
                    });

                    console.log('üì° Statut r√©ponse:', response.status);

                    if (!response.ok) {
                        const errorData = await response.text();
                        console.error('‚ùå Erreur API:', errorData);
                        throw new Error(`API Error: ${response.status}`);
                    }

                    const data = await response.json();
                    console.log('‚úÖ Analyse re√ßue:', data);
                    
                    if (data.success && data.analysis) {
                        trackEvent('photo_analyzed', { success: true, model: 'claude-vision' });
                        return `üì∏ **ANALYSE PHOTO EXPERT** üß†\n\n${data.analysis}`;
                    } else if (data.fallback) {
                        trackEvent('photo_analyzed', { success: false, fallback: true });
                        return data.fallback;
                    } else {
                        throw new Error('R√©ponse API invalide');
                    }

                } catch (error) {
                    console.error('üí• Erreur analyse photo:', error);
                    trackEvent('photo_analyzed', { success: false, error: error.message });
                    
                    // Fallback intelligent
                    return `üì∏ **Photo re√ßue !** Analyse en cours...

üîç **Dis-moi ce que tu vois :**
üü° **Quels voyants** sont allum√©s (couleur, forme) ?
üì± **Messages affich√©s** ? ("Antipollution d√©faillante"...)
üöó **Marque/mod√®le** de ta voiture ?

üí° *L'analyse automatique est temporairement indisponible, mais je peux t'aider avec ces infos !*`;
                }
            };

            // R√©ponses autonomes optimis√©es pour conversion
            const getAutonomousResponse = (userMsg) => {
                const lowerMsg = userMsg.toLowerCase();

                // D√©tection v√©hicule + sympt√¥mes pour tracking
                const vehicleMatch = lowerMsg.match(/\b(audi|bmw|peugeot|citro√´n|citroen|renault|volkswagen|vw|mercedes|ford|opel|seat|skoda|volvo|nissan|toyota|hyundai|kia|mazda|subaru|mitsubishi|honda|fiat|alfa romeo|mini|land rover|jaguar|porsche|bentley|aston martin|ferrari|lamborghini|maserati|lexus|acura|infiniti)\b/i);
                
                if (vehicleMatch) {
                    setLeadData(prev => ({...prev, vehicle: {brand: vehicleMatch[0]}}));
                }

                // PROBL√àMES FAP - QUALIFICATION RAPIDE
                if (lowerMsg.includes('voyant') && (lowerMsg.includes('fap') || lowerMsg.includes('filtre'))) {
                    trackEvent('symptom_detected', { symptom: 'voyant_fap', vehicle: vehicleMatch?.[0] });
                    return `üéØ **Voyant FAP allum√© !** C'est exactement ma sp√©cialit√© !

**Questions flash pour diagnostic :**
üîß **O√π en es-tu ?** FAP encore mont√© ou d√©j√† d√©mont√© ?
üõ£Ô∏è **R√©g√©n√©ration tent√©e ?** (20 km autoroute √† 90 km/h)
üí® **Fum√©e r√©cente ?** Couleur ?

${vehicleMatch ? `**${vehicleMatch[0]}** not√© ! üëç` : ''}

**Je te donne la solution la + √©conomique selon ta situation !** üí∞`;
                }

                // CODES D√âFAUTS FAP - DIAGNOSTIC AVANC√â
                if (lowerMsg.includes('p2002') || lowerMsg.includes('p2463') || lowerMsg.includes('p0401')) {
                    const code = lowerMsg.match(/p\d{4}/i)?.[0].toUpperCase();
                    trackEvent('dtc_code_detected', { code, vehicle: vehicleMatch?.[0] });
                    
                    const codeInfo = {
                        'P2002': 'FAP satur√© - Efficacit√© en dessous du seuil',
                        'P2463': 'Accumulation critique de suies FAP',
                        'P0401': 'Vanne EGR d√©faillante - D√©bit insuffisant'
                    };

                    return `üéØ **Code ${code} = ${codeInfo[code] || 'D√©faut d√©pollution'}**

**Diagnostic express :**
üöó **Conduite** majoritairement urbaine ou mixte ?
‚öôÔ∏è **Sympt√¥mes** : perte puissance, surconsommation ?
üîß **Bricoleur** ou tu pr√©f√®res confier √† un pro ?

${vehicleMatch ? `**${vehicleMatch[0]} ${code}** - j'ai trait√© 100+ cas identiques ! üí™` : ''}

**Solution personnalis√©e selon ton profil !** üõ†Ô∏è`;
                }

                // FUM√âE - QUALIFICATION IMM√âDIATE
                if (lowerMsg.includes('fum√©e') || lowerMsg.includes('fume')) {
                    trackEvent('symptom_detected', { symptom: 'fumee', vehicle: vehicleMatch?.[0] });
                    
                    if (lowerMsg.includes('noir')) {
                        return `üí® **Fum√©e noire = FAP satur√© !** Ma sp√©cialit√© absolue !

**Questions cibl√©es :**
üîß **Permanent** ou seulement en acc√©l√©ration ?
üü° **Voyant moteur** allum√© aussi ?
üí™ **Ton profil** : bricoleur ou tu confies √† un garage ?

${vehicleMatch ? `**${vehicleMatch[0]}** - probl√®me classique ! ` : ''}

**‚Üí Je te guide vers la solution la + rentable !** üí∞`;
                    }
                    
                    if (lowerMsg.includes('blanc')) {
                        return `üí® **Fum√©e blanche = EGR suspecte !**

**Questions rapides :**
üå°Ô∏è **Seulement √† froid** au d√©marrage ?
üîß **Ralenti instable** ?
üí™ **Tu d√©mont√©s toi-m√™me** ou tu pr√©f√®res un garage ?

${vehicleMatch ? `**${vehicleMatch[0]}** - EGR probl√©matique connue ! ` : ''}

**Solutions Re-Fap selon ton profil !** üõ†Ô∏è`;
                    }
                }

                // R√âPONSES DE QUALIFICATION CLIENT
                if (lowerMsg.includes('bricoleur') || lowerMsg.includes('d√©monter') || lowerMsg.includes('moi-m√™me') || lowerMsg.includes('moi m√™me')) {
                    setLeadData(prev => ({...prev, profile: 'bricoleur'}));
                    return generateBricoleurResponse(lowerMsg, vehicleMatch?.[0]);
                }

                if (lowerMsg.includes('garage') || lowerMsg.includes('professionnel') || lowerMsg.includes('confier')) {
                    setLeadData(prev => ({...prev, profile: 'garage'}));
                    return generateGarageResponse(lowerMsg, vehicleMatch?.[0]);
                }

                // D√âTECTION PROBL√àME R√âSOLU OU H√âSITATION
                if (lowerMsg.includes('d√©j√†') && (lowerMsg.includes('d√©mont√©') || lowerMsg.includes('enlev√©'))) {
                    return `üîß **FAP d√©j√† d√©mont√© ?** Parfait !

**Options Re-Fap :**
üìç **Point de collecte** proche de toi
üì¶ **Envoi postal** s√©curis√©
‚ö° **Nettoyage 24-48h** garanti

**Dis-moi ta r√©gion** pour t'orienter ! üó∫Ô∏è`;
                }

                if (lowerMsg.includes('prix') || lowerMsg.includes('co√ªt') || lowerMsg.includes('tarif')) {
                    return `üí∞ **Co√ªts Re-Fap vs Concurrence :**

**Nettoyage Re-Fap :** 150-350‚Ç¨ selon mod√®le
**FAP neuf :** 1500-3500‚Ç¨ üò±
**√âconomie :** 80% en moyenne !

üîß **Ton profil ?**
- **Bricoleur** ‚Üí D√©p√¥t direct + √©conomie max
- **Garage** ‚Üí Diagnostic + installation pro

**Quelle option t'int√©resse ?** üéØ`;
                }

                // PROBL√àMES HORS SP√âCIALIT√â (redirection partenaire)
                if (lowerMsg.includes('vibration') || lowerMsg.includes('frein') || lowerMsg.includes('bo√Æte') || 
                    lowerMsg.includes('embrayage') || lowerMsg.includes('direction') || lowerMsg.includes('suspension')) {
                    
                    const probleme = lowerMsg.includes('vibration') ? 'vibrations' :
                                   lowerMsg.includes('frein') ? 'freinage' :
                                   lowerMsg.includes('bo√Æte') ? 'bo√Æte de vitesses' :
                                   lowerMsg.includes('embrayage') ? 'embrayage' :
                                   lowerMsg.includes('direction') ? 'direction' : 'suspension';
                    
                    trackEvent('out_of_scope', { problem: probleme, vehicle: vehicleMatch?.[0] });
                    
                    return `üîß **Probl√®me ${probleme} d√©tect√©**

**Pas ma sp√©cialit√©** - Expert d√©pollution FAP/EGR/AdBlue uniquement.

**Redirection partenaire :**`;
                }

                // CAS G√âN√âRAL - ORIENTATION RAPIDE
                trackEvent('general_inquiry', { vehicle: vehicleMatch?.[0] });
                return `üéØ **Diagnostic FAP/EGR/AdBlue express :**

**Dis-moi en 2 mots :**
üü° **Sympt√¥me** : voyant allum√©, fum√©e, message erreur...
üöó **V√©hicule** : marque/mod√®le
üí™ **Ton profil** : bricoleur ou garage ?

${vehicleMatch ? `**${vehicleMatch[0]}** not√© ! üëç` : ''}

üì∏ **Photo de voyant = diagnostic ultra-pr√©cis !**`;
            };

            // R√©ponse pour profil bricoleur
            const generateBricoleurResponse = (msg, vehicle) => {
                return `üîß **Profil bricoleur d√©tect√© !** Parfait pour Re-Fap !

**Avantages pour toi :**
üí∞ **√âconomie max** : pas de main d'≈ìuvre garage
‚ö° **Direct producteur** : tarifs pr√©f√©rentiels  
üó∫Ô∏è **500+ points** de collecte en France
üì¶ **Envoi postal** possible si √©loign√©

**Prochaine √©tape :**
Tu d√©mont√©s ton FAP et on s'occupe du reste !

**Veux-tu qu'on te rappelle** pour t'expliquer la proc√©dure exacte ?`;
            };

            // R√©ponse pour profil garage
            const generateGarageResponse = (msg, vehicle) => {
                return `üè™ **Tu pr√©f√®res un garage ?** Excellent choix !

**Avantages garage partenaire :**
üîç **Diagnostic confirm√©** avant d√©montage
üîß **Installation pro** + garantie
üìã **Prise en charge compl√®te** sans stress
ü§ù **R√©seau Re-Fap** : 200+ garages de confiance

**Je te recommande vivement** un diagnostic pro pour confirmer !`;
            };

            // Fonction pour g√©n√©rer les boutons CTA selon le profil
            const generateCTAButtons = (profile, symptom) => {
                if (profile === 'bricoleur') {
                    return `**Rappel gratuit** pour proc√©dure exacte`;
                } else if (profile === 'garage') {
                    return `**Garage de confiance** pr√®s de chez toi`;
                } else {
                    return `**Diagnostic pro** pour confirmer`;
                }
            };

            const handleSendMessage = async (e) => {
                e.preventDefault();
                if (!inputMessage.trim()) return;
                
                const userMsg = inputMessage.trim();
                addMessage(userMsg, 'user');
                setInputMessage('');
                setIsTyping(true);

                // Track message
                trackEvent('message_sent', { message: userMsg.substring(0, 50) });

                setTimeout(() => {
                    const response = getAutonomousResponse(userMsg);
                    addMessage(response, 'bot', 'auto');
                    setIsTyping(false);
                }, 1200);
            };

            const handleImageUpload = async (event) => {
                const file = event.target.files[0];
                if (file) {
                    if (!file.type.startsWith('image/')) {
                        alert('üì∏ Merci d\'envoyer une image (JPG, PNG...)');
                        return;
                    }
                    
                    addMessage(`üì∏ Photo envoy√©e : ${file.name}`, 'user');
                    setIsTyping(true);
                    trackEvent('photo_uploaded', { fileName: file.name, fileSize: file.size });
                    
                    // Compression d'image pour √©viter l'erreur 413
                    const compressImage = (file, maxWidth = 800, quality = 0.8) => {
                        return new Promise((resolve) => {
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            const img = new Image();
                            
                            img.onload = () => {
                                // Calculer nouvelles dimensions
                                let { width, height } = img;
                                if (width > maxWidth) {
                                    height = (height * maxWidth) / width;
                                    width = maxWidth;
                                }
                                
                                canvas.width = width;
                                canvas.height = height;
                                
                                // Dessiner l'image redimensionn√©e
                                ctx.drawImage(img, 0, 0, width, height);
                                
                                // Convertir en base64 avec compression
                                const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                                resolve(compressedDataUrl);
                            };
                            
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                img.src = e.target.result;
                            };
                            reader.readAsDataURL(file);
                        });
                    };
                    
                    try {
                        let imageData;
                        
                        // Si l'image est trop grosse, on la compresse
                        if (file.size > 1024 * 1024) { // > 1MB
                            console.log('üóúÔ∏è Compression image en cours...');
                            imageData = await compressImage(file, 800, 0.8);
                            console.log('‚úÖ Image compress√©e');
                        } else {
                            const reader = new FileReader();
                            imageData = await new Promise((resolve) => {
                                reader.onload = (e) => resolve(e.target.result);
                                reader.readAsDataURL(file);
                            });
                        }
                        
                        const analysis = await analyzeImageWithClaude(imageData, file.name);
                        addMessage(analysis, 'bot', 'claude');
                        
                    } catch (error) {
                        console.error('‚ùå Erreur upload:', error);
                        addMessage(`‚ùå Erreur analyse : ${error.message}`, 'bot');
                    }
                    
                    setIsTyping(false);
                    event.target.value = '';
                }
            };

            // G√©n√©ration de message CTA selon contexte
            const generateCTAMessage = (context) => {
                const lowerContext = context.toLowerCase();
                
                if (lowerContext.includes('voyant fap') || lowerContext.includes('code')) {
                    return `üéØ **Prochaine √©tape recommand√©e :**

Pour **confirmer le diagnostic** et √©viter une erreur co√ªteuse, je recommande vivement :

üîç **Diagnostic professionnel** chez un garage partenaire Re-Fap
‚úÖ **Confirmation** avant d√©montage  
üí∞ **√âvite** les frais inutiles
ü§ù **R√©seau de confiance** v√©rifi√©

**Ou** si tu es bricoleur confirm√© : 

üìû **Rappel gratuit** pour proc√©dure exacte de d√©montage`;
                }
                
                if (lowerContext.includes('bricoleur') || lowerContext.includes('d√©monte')) {
                    return `üîß **Parfait pour un profil bricoleur !**

**Options Re-Fap pour toi :**
üìç **500+ points de collecte** en France  
üì¶ **Envoi postal** s√©curis√© possible
‚ö° **Nettoyage 24-48h** garanti
üí∞ **Tarif pr√©f√©rentiel** sans main d'≈ìuvre

**Veux-tu qu'on t'explique** la proc√©dure exacte ?`;
                }
                
                return `üéØ **Je te recommande :**

üè™ **Garage de confiance** ‚Üí Diagnostic + installation pro
üìû **Rappel gratuit** ‚Üí Conseil personnalis√©`;
            };

            // Formulaire de callback
            const generateCallbackForm = () => {
                return `üìû **Rappel gratuit Re-Fap**

**Un expert va t'appeler** dans les 2h ouvr√©es !

üéØ **Au programme :**
‚úÖ Confirmation diagnostic  
‚úÖ Solution la + √©conomique
‚úÖ Proc√©dure d√©taill√©e
‚úÖ Devis pr√©cis

**Formulaire** : https://re-fap.fr/contact/

**Ou SMS direct** au **06.XX.XX.XX.XX** avec :
- Nom/Pr√©nom
- T√©l√©phone  
- Marque v√©hicule + sympt√¥me

**Rappel garanti sous 2h !** ‚è±Ô∏è`;
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-orange-50">
                    {/* Header */}
                    <header className="bg-white shadow-sm border-b">
                        <div className="max-w-4xl mx-auto px-4 py-3 flex items-center justify-between">
                            <div className="flex items-center">
                                <img src="https://re-fap.fr/wp-content/uploads/2020/07/logo-re-fap.png" alt="Re-Fap" className="h-8 mr-3" />
                                <div>
                                    <h1 className="text-lg font-bold text-gray-800">Julien - Expert FAP</h1>
                                    <p className="text-xs text-gray-600">Diagnostic gratuit ‚Ä¢ 20 ans d'exp√©rience</p>
                                </div>
                            </div>
                            <button 
                                onClick={handleContactRequest}
                                className="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                            >
                                üìû Devis gratuit
                            </button>
                        </div>
                    </header>

                    {/* Chat principal */}
                    <div className="max-w-4xl mx-auto p-4">
                        <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                            {/* Header chat */}
                            <div className="bg-gradient-to-r from-orange-600 to-red-600 text-white p-4">
                                <div className="flex items-center">
                                    <div className="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center mr-3">
                                        <span className="text-2xl">üë®‚Äçüîß</span>
                                    </div>
                                    <div>
                                        <h2 className="text-xl font-bold">Julien, ton expert FAP</h2>
                                        <p className="text-orange-100 text-sm">Diagnostic GRATUIT ‚Ä¢ Sp√©cialiste Re-Fap depuis 20 ans</p>
                                    </div>
                                </div>
                            </div>

                            {/* Messages */}
                            <div className="h-96 overflow-y-auto p-4 bg-gray-50">
                                {messages.map((message, index) => (
                                    <div key={index} className={`mb-4 ${message.type === 'user' ? 'text-right' : ''}`}>
                                        <div className={`inline-block p-3 rounded-lg max-w-md ${
                                            message.type === 'user' 
                                                ? 'bg-blue-500 text-white' 
                                                : message.source === 'claude'
                                                    ? 'bg-purple-100 text-gray-800 border-l-4 border-purple-500'
                                                    : 'bg-white text-gray-800 border border-gray-200'
                                        }`}>
                                            {typeof message.content === 'string' ? 
                                                message.content.split('\n').map((line, i) => (
                                                    <div key={i} className={line.startsWith('**') ? 'font-bold' : ''}>{line}</div>
                                                )) : 
                                                <div>Message non support√©</div>
                                            }
                                            
                                            {message.type === 'bot' && (
                                                <div className="text-xs text-gray-400 mt-2">
                                                    {message.source === 'claude' ? 'üß† IA' : '‚ö° Expert'} ‚Ä¢ {new Date(message.timestamp).toLocaleTimeString()}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                ))}
                                
                                {isTyping && (
                                    <div className="mb-4">
                                        <div className="inline-block bg-white p-3 rounded-lg border border-gray-200">
                                            <div className="flex items-center space-x-2">
                                                <div className="flex space-x-1">
                                                    <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                                                    <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.1s'}}></div>
                                                    <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                                                </div>
                                                <span className="text-sm text-gray-600">Julien analyse...</span>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Input */}
                            <div className="p-4 border-t bg-white">
                                <form onSubmit={handleSendMessage} className="flex gap-2 mb-3">
                                    <input
                                        type="text"
                                        value={inputMessage}
                                        onChange={(e) => setInputMessage(e.target.value)}
                                        placeholder="üí¨ D√©cris ton probl√®me FAP/EGR... (ex: 'Voyant moteur allum√© + fum√©e noire')"
                                        className="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500"
                                        disabled={isTyping}
                                    />
                                    <button
                                        type="submit"
                                        disabled={isTyping || !inputMessage.trim()}
                                        className="bg-orange-500 hover:bg-orange-600 disabled:bg-gray-300 text-white px-6 py-3 rounded-lg font-medium transition-colors"
                                    >
                                        Envoyer
                                    </button>
                                </form>

                                {/* Upload photo */}
                                <div className="mb-3 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border-2 border-dashed border-blue-300">
                                    <div className="text-center">
                                        <input
                                            type="file"
                                            id="imageUpload"
                                            accept="image/*"
                                            onChange={handleImageUpload}
                                            className="hidden"
                                            disabled={isTyping}
                                        />
                                        <label 
                                            htmlFor="imageUpload" 
                                            className="cursor-pointer bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg inline-flex items-center gap-2 font-medium transition-colors"
                                        >
                                            üì∏ Photo de mon voyant
                                        </label>
                                        <p className="text-xs text-gray-600 mt-2">
                                            JPG/PNG max 5MB ‚Ä¢ Julien analysera automatiquement ! üß†
                                        </p>
                                    </div>
                                </div>

                                {/* Quick options avec CTA optimis√©s */}
                                <div className="grid grid-cols-2 gap-2">
                                    {[
                                        { text: "üü° Voyant FAP", msg: "Voyant FAP allum√©", cta: true },
                                        { text: "üí® Fum√©e noire", msg: "Fum√©e noire √† l'√©chappement", cta: true },
                                        { text: "üì± Code erreur", msg: "J'ai un code erreur affich√©", cta: false },
                                        { text: "üîß Je suis bricoleur", msg: "Je d√©monte moi-m√™me", cta: true }
                                    ].map((option, index) => (
                                        <button
                                            key={index}
                                            onClick={() => {
                                                addMessage(option.msg, 'user');
                                                setIsTyping(true);
                                                setTimeout(() => {
                                                    const response = getAutonomousResponse(option.msg);
                                                    addMessage(response, 'bot', 'auto');
                                                    
                                                    // Ajouter CTA si n√©cessaire
                                                    if (option.cta) {
                                                        setTimeout(() => {
                                                            addMessage(generateCTAMessage(option.msg), 'bot', 'cta');
                                                        }, 2000);
                                                    }
                                                    setIsTyping(false);
                                                }, 1000);
                                            }}
                                            disabled={isTyping}
                                            className="bg-gray-100 hover:bg-gray-200 p-2 rounded text-sm disabled:opacity-50 transition-colors"
                                        >
                                            {option.text}
                                        </button>
                                    ))}
                                </div>

                                {/* CTA Section - Toujours visible */}
                                <div className="mt-4 p-3 bg-gradient-to-r from-orange-50 to-red-50 rounded-lg border border-orange-200">
                                    <h4 className="font-bold text-orange-800 text-sm mb-2">üéØ Besoin d'aide ?</h4>
                                    <div className="grid grid-cols-1 gap-2">
                                        <button
                                            onClick={() => window.open('https://www.idgarages.com/fr-fr/prestations/diagnostic-electronique?utm_source=re-fap&utm_medium=partenariat&utm_campaign=diagnostic-electronique&ept-publisher=re-fap&ept-name=re-fap-diagnostic-electronique', '_blank')}
                                            className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded text-sm font-medium transition-colors"
                                        >
                                            üè™ Trouver un garage de confiance
                                        </button>
                                        <button
                                            onClick={() => {
                                                trackEvent('callback_requested', { sessionId: leadData.sessionId });
                                                addMessage("Je souhaite √™tre rappel√© gratuitement", 'user');
                                                setTimeout(() => {
                                                    addMessage(generateCallbackForm(), 'bot', 'form');
                                                }, 1000);
                                            }}
                                            className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded text-sm font-medium transition-colors"
                                        >
                                            üìû √ätre rappel√© gratuitement
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Footer */}
                    <footer className="max-w-4xl mx-auto px-4 py-6 text-center text-sm text-gray-600">
                        <div className="flex items-center justify-center space-x-6 mb-3">
                            <span className="flex items-center"><span className="text-green-500 mr-1">‚úÖ</span> Diagnostic gratuit</span>
                            <span className="flex items-center"><span className="text-blue-500 mr-1">üß†</span> IA + 20 ans exp√©rience</span>
                            <span className="flex items-center"><span className="text-orange-500 mr-1">üí∞</span> Solutions √©conomiques</span>
                        </div>
                        <p className="text-xs">
                            Powered by <a href="https://re-fap.fr" className="text-orange-600 hover:underline">Re-Fap</a> ‚Ä¢ 
                            Expert nettoyage FAP depuis 2015 ‚Ä¢ 
                            Session: {leadData.sessionId}
                        </p>
                    </footer>
                </div>
            );
        };

        ReactDOM.render(<JulienProduction />, document.getElementById('root'));
    </script>
</body>
</html>
