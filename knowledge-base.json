{
  "version": "2.0.0",
  "metadata": {
    "name": "FAP Re-Fap Expert Knowledge Base",
    "description": "Base de connaissances compl√®te pour diagnostic FAP",
    "last_updated": "2025-01-01",
    "author": "Julien - Expert FAP Re-Fap"
  },
  
  "signals": {
    "dashboard_lights": {
      "id": "dashboard_lights",
      "name": "Voyants tableau de bord",
      "type": "multiple_choice",
      "question": "Quels voyants sont allum√©s sur votre tableau de bord ?",
      "explanation": "Les voyants nous donnent des indices pr√©cis sur le syst√®me d√©faillant",
      "priority": 1,
      "options": [
        {"id": "engine_light", "label": "üî∂ Voyant moteur", "weight": 3},
        {"id": "dpf_light", "label": "üü° Voyant FAP", "weight": 5},
        {"id": "adblue_light", "label": "üîµ Voyant AdBlue", "weight": 2},
        {"id": "glow_plug", "label": "üü† Voyant pr√©chauffage", "weight": 2},
        {"id": "oil_light", "label": "üî¥ Voyant huile", "weight": 1},
        {"id": "no_lights", "label": "‚ùå Aucun voyant", "weight": 0}
      ]
    },
    
    "power_loss": {
      "id": "power_loss",
      "name": "Perte de puissance",
      "type": "multiple_choice",
      "question": "D√©crivez la perte de puissance que vous ressentez :",
      "explanation": "Le type de perte de puissance aide √† identifier la cause",
      "priority": 2,
      "options": [
        {"id": "acceleration", "label": "üöó √Ä l'acc√©l√©ration", "weight": 4},
        {"id": "highway", "label": "üõ£Ô∏è Sur autoroute", "weight": 3},
        {"id": "uphill", "label": "‚õ∞Ô∏è En mont√©e", "weight": 4},
        {"id": "permanent", "label": "üîÑ Permanente", "weight": 5},
        {"id": "intermittent", "label": "‚ö° Par √†-coups", "weight": 2},
        {"id": "no_loss", "label": "‚ùå Pas de perte", "weight": 0}
      ]
    },
    
    "exhaust_smoke": {
      "id": "exhaust_smoke",
      "name": "Fum√©e d'√©chappement",
      "type": "multiple_choice",
      "question": "Observez-vous de la fum√©e √† l'√©chappement ?",
      "explanation": "La couleur de fum√©e indique le type de probl√®me",
      "priority": 3,
      "options": [
        {"id": "black_smoke", "label": "‚ö´ Fum√©e noire", "weight": 5},
        {"id": "white_smoke", "label": "‚ö™ Fum√©e blanche", "weight": 2},
        {"id": "blue_smoke", "label": "üîµ Fum√©e bleue", "weight": 1},
        {"id": "no_smoke", "label": "‚ùå Pas de fum√©e", "weight": 0}
      ]
    },
    
    "error_codes": {
      "id": "error_codes",
      "name": "Codes d'erreur OBD",
      "type": "text_input",
      "question": "Avez-vous des codes d'erreur (P2002, P2463, etc.) ?",
      "explanation": "Les codes OBD donnent un diagnostic pr√©cis du probl√®me",
      "priority": 0,
      "patterns": [
        {"pattern": "P2002", "weight": 10, "urgent": false, "description": "Efficacit√© FAP insuffisante"},
        {"pattern": "P2463", "weight": 15, "urgent": true, "description": "Accumulation excessive de suie"},
        {"pattern": "P244A", "weight": 12, "urgent": true, "description": "Capteur pression diff√©rentielle"},
        {"pattern": "P244B", "weight": 8, "urgent": false, "description": "Capteur pression FAP"},
        {"pattern": "P2031", "weight": 6, "urgent": false, "description": "Sonde temp√©rature √©chappement"}
      ]
    },
    
    "driving_pattern": {
      "id": "driving_pattern",
      "name": "Type de conduite",
      "type": "multiple_choice",
      "question": "Quel type de conduite pratiquez-vous principalement ?",
      "explanation": "Le FAP a besoin de longs trajets pour se r√©g√©n√©rer",
      "priority": 4,
      "options": [
        {"id": "city_only", "label": "üèôÔ∏è Uniquement ville (< 20 min)", "weight": 5},
        {"id": "mixed_short", "label": "üîÑ Mixte courts trajets", "weight": 3},
        {"id": "mixed_long", "label": "üõ£Ô∏è Mixte longs trajets", "weight": 1},
        {"id": "highway_frequent", "label": "üöÄ Autoroute fr√©quente", "weight": 0}
      ]
    },
    
    "vehicle_mileage": {
      "id": "vehicle_mileage",
      "name": "Kilom√©trage v√©hicule",
      "type": "number",
      "question": "Quel est le kilom√©trage de votre v√©hicule ?",
      "explanation": "L'√¢ge du FAP influence les solutions possibles",
      "priority": 5,
      "ranges": [
        {"min": 0, "max": 50000, "weight": 1, "label": "V√©hicule r√©cent"},
        {"min": 50001, "max": 150000, "weight": 3, "label": "V√©hicule mature"},
        {"min": 150001, "max": 300000, "weight": 5, "label": "V√©hicule ancien"},
        {"min": 300001, "max": 999999, "weight": 4, "label": "V√©hicule tr√®s ancien"}
      ]
    }
  },
  
  "causes": {
    "dpf_clogged": {
      "id": "dpf_clogged",
      "name": "FAP colmat√©",
      "description": "Filtre √† particules satur√© en suie",
      "probability_base": 0.75,
      "signal_weights": {
        "dashboard_lights": {"dpf_light": 5, "engine_light": 3},
        "power_loss": {"acceleration": 4, "permanent": 5, "uphill": 4},
        "exhaust_smoke": {"black_smoke": 5},
        "driving_pattern": {"city_only": 5, "mixed_short": 3},
        "error_codes": {"P2002": 10, "P2463": 15}
      },
      "technical_explanation": "La suie s'accumule dans le FAP car la r√©g√©n√©ration ne peut pas s'effectuer (temp√©rature insuffisante < 600¬∞C pendant 20+ minutes)",
      "severity": "moderate"
    },
    
    "dpf_sensor_failure": {
      "id": "dpf_sensor_failure", 
      "name": "Capteur FAP d√©faillant",
      "description": "Capteur de pression diff√©rentielle HS",
      "probability_base": 0.15,
      "signal_weights": {
        "dashboard_lights": {"engine_light": 4},
        "error_codes": {"P244A": 12, "P244B": 8},
        "power_loss": {"intermittent": 3}
      },
      "technical_explanation": "Le capteur ne peut plus mesurer l'√©tat d'encrassement du FAP",
      "severity": "low"
    },
    
    "dpf_physical_damage": {
      "id": "dpf_physical_damage",
      "name": "FAP endommag√© physiquement",
      "description": "Structure interne du FAP d√©t√©rior√©e",
      "probability_base": 0.10,
      "signal_weights": {
        "vehicle_mileage": 5,
        "error_codes": {"P2463": 10},
        "exhaust_smoke": {"black_smoke": 4}
      },
      "technical_explanation": "Fissures ou destruction des canaux internes du FAP",
      "severity": "high"
    },
    
    "egr_related": {
      "id": "egr_related",
      "name": "Probl√®me EGR li√©",
      "description": "Vanne EGR impactant le FAP",
      "probability_base": 0.20,
      "signal_weights": {
        "dashboard_lights": {"glow_plug": 4, "engine_light": 2},
        "power_loss": {"intermittent": 3},
        "driving_pattern": {"city_only": 2}
      },
      "technical_explanation": "La vanne EGR encrass√©e perturbe la combustion et surcharge le FAP",
      "severity": "moderate"
    }
  },
  
  "workflows": {
    "highway_regeneration": {
      "id": "highway_regeneration",
      "name": "R√©g√©n√©ration autoroute",
      "category": "self_service",
      "cost_level": 1,
      "invasiveness": 1,
      "conditions": {
        "required": ["dpf_clogged"],
        "excluded": ["dpf_physical_damage"],
        "max_severity": "moderate"
      },
      "steps": [
        {
          "step": 1,
          "title": "Pr√©paration",
          "instructions": "V√©rifiez le niveau de carburant (> 1/4 plein)",
          "duration": "2 min",
          "safety_notes": ["Carburant suffisant obligatoire"]
        },
        {
          "step": 2,
          "title": "Trajet autoroute", 
          "instructions": "Roulez 30+ km √† 90+ km/h en 4√®me/5√®me vitesse",
          "duration": "30-45 min",
          "safety_notes": ["Respectez les limitations", "Restez sur voie de droite"]
        },
        {
          "step": 3,
          "title": "V√©rification",
          "instructions": "V√©rifiez si les voyants se sont √©teints",
          "duration": "1 min"
        }
      ],
      "success_criteria": [
        "Disparition du voyant FAP/moteur",
        "Retour de la puissance normale",
        "Absence de fum√©e noire"
      ],
      "next_workflows": {
        "success": "monitor_driving_habits",
        "partial": "additive_treatment", 
        "failure": "professional_diagnosis"
      },
      "success_probability": 0.65
    },
    
    "additive_treatment": {
      "id": "additive_treatment",
      "name": "Traitement additif FAP",
      "category": "self_service",
      "cost_level": 2,
      "invasiveness": 1,
      "conditions": {
        "required": ["dpf_clogged"],
        "previous_attempts": ["highway_regeneration"]
      },
      "steps": [
        {
          "step": 1,
          "title": "Choix additif",
          "instructions": "Utilisez additif FAP Re-Fap (dosage selon notice)",
          "duration": "5 min"
        },
        {
          "step": 2,
          "title": "Application",
          "instructions": "Versez dans le r√©servoir puis faites le plein",
          "duration": "10 min"
        },
        {
          "step": 3,
          "title": "Cycle de traitement",
          "instructions": "Roulez normalement 300-500 km",
          "duration": "1 semaine"
        }
      ],
      "success_criteria": [
        "Am√©lioration progressive des performances",
        "R√©duction de la fum√©e"
      ],
      "next_workflows": {
        "success": "monitor_driving_habits",
        "failure": "professional_cleaning"
      },
      "success_probability": 0.45
    },
    
    "professional_cleaning": {
      "id": "professional_cleaning",
      "name": "Nettoyage professionnel FAP",
      "category": "professional",
      "cost_level": 4,
      "invasiveness": 3,
      "conditions": {
        "any_of": ["dpf_clogged", "dpf_sensor_failure"],
        "failed_attempts": ["highway_regeneration", "additive_treatment"]
      },
      "steps": [
        {
          "step": 1,
          "title": "Diagnostic approfondi",
          "instructions": "Mesure pression diff√©rentielle + codes erreur",
          "duration": "30 min"
        },
        {
          "step": 2,
          "title": "D√©montage FAP",
          "instructions": "D√©pose du filtre pour nettoyage",
          "duration": "60 min"
        },
        {
          "step": 3,
          "title": "Nettoyage machine",
          "instructions": "Nettoyage haute pression + produits sp√©cialis√©s",
          "duration": "120 min"
        },
        {
          "step": 4,
          "title": "Remontage + test",
          "instructions": "Remontage + test de fonctionnement",
          "duration": "30 min"
        }
      ],
      "success_criteria": [
        "Pression diff√©rentielle < 25 mbar",
        "Disparition des codes erreur",
        "Test r√©g√©n√©ration forc√©e OK"
      ],
      "next_workflows": {
        "success": "monitor_driving_habits",
        "failure": "dpf_replacement"
      },
      "success_probability": 0.85
    },
    
    "emergency_intervention": {
      "id": "emergency_intervention",
      "name": "Intervention d'urgence",
      "category": "urgent",
      "cost_level": 5,
      "invasiveness": 4,
      "conditions": {
        "error_codes": ["P2463", "P244A"],
        "severity": "high"
      },
      "immediate_actions": [
        "üö® ARR√äTEZ de rouler imm√©diatement",
        "üîß Contactez un professionnel dans l'heure",
        "‚ö†Ô∏è Risque de dommages moteur si conduite prolong√©e"
      ],
      "steps": [
        {
          "step": 1,
          "title": "Diagnostic urgent",
          "instructions": "Analyse compl√®te OBD + inspection visuelle",
          "duration": "45 min"
        },
        {
          "step": 2,
          "title": "Action corrective",
          "instructions": "Selon diagnostic : nettoyage, remplacement ou reprogrammation",
          "duration": "120-240 min"
        }
      ],
      "success_probability": 0.95
    }
  },
  
  "response_templates": {
    "diagnosis_confidence_high": {
      "template": "üéØ **Diagnostic avec {confidence}% de certitude**\n\n**Probl√®me identifi√© :** {cause_name}\n\n**Explication :** {technical_explanation}\n\n**Solution recommand√©e :** {primary_workflow}",
      "tone": "confident"
    },
    
    "diagnosis_confidence_medium": {
      "template": "üîç **Analyse en cours - {confidence}% de certitude**\n\nBas√© sur vos sympt√¥mes, voici les causes les plus probables :\n\n{top_causes}\n\nPour affiner le diagnostic, j'ai besoin de :\n{additional_questions}",
      "tone": "investigative"
    },
    
    "workflow_explanation": {
      "template": "üîß **{workflow_name}**\n\n**Pourquoi cette solution :** {rationale}\n\n**√âtapes :**\n{steps}\n\n**Taux de succ√®s :** {success_rate}%\n\n**Si √ßa ne marche pas :** {fallback_plan}",
      "tone": "instructional"
    },
    
    "gathering_information": {
      "template": "üîç **Collecte d'informations ({progress}%)**\n\n{question}\n\nüí° {explanation}",
      "tone": "questioning"
    }
  }
}
